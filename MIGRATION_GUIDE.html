<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIBCO to Spring Boot Migration Guide</title>
    <style>
        @page {
            margin: 2cm;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            page-break-before: always;
        }
        h1:first-of-type {
            page-break-before: avoid;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-left: 4px solid #3498db;
            padding-left: 10px;
        }
        h3 {
            color: #555;
            margin-top: 20px;
        }
        pre {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-left: 3px solid #3498db;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        .diagram {
            background: #f9f9f9;
            border: 2px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            white-space: pre;
            overflow-x: auto;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .feature-box {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
        }
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
        }
        .toc {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 20px;
            margin: 20px 0;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        .toc li {
            padding: 5px 0;
        }
        .toc a {
            color: #3498db;
            text-decoration: none;
        }
        .toc a:hover {
            text-decoration: underline;
        }
        @media print {
            body {
                background: white;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>

<h1>TIBCO BusinessWorks to Spring Boot Migration Guide</h1>

<div class="toc">
    <h2>Table of Contents</h2>
    <ul>
        <li><a href="#overview">1. Overview</a></li>
        <li><a href="#architecture">2. Architecture</a></li>
        <li><a href="#components">3. Component Details</a></li>
        <li><a href="#setup">4. Setup Instructions</a></li>
        <li><a href="#usage">5. Usage Examples</a></li>
        <li><a href="#flows">6. Flow Diagrams</a></li>
        <li><a href="#sequences">7. Sequence Diagrams</a></li>
        <li><a href="#outputs">8. Generated Outputs</a></li>
        <li><a href="#troubleshooting">9. Troubleshooting</a></li>
        <li><a href="#ai-enablement">10. Enabling AI-Powered Code Generation</a></li>
        <li><a href="#hexagonal">11. Hexagonal Architecture Support</a></li>
        <li><a href="#api-gateway">12. API Gateway (Spring Cloud Gateway)</a></li>
    </ul>
</div>

<h1 id="overview">1. Overview</h1>

<div class="feature-box">
    <h3>Project Summary</h3>
    <p>This project provides an <strong>automated migration framework</strong> to convert TIBCO BusinessWorks (BW) process definitions into modern Spring Boot microservices (REST and SOAP).</p>
</div>

<h2>Key Features</h2>
<ul>
    <li>✅ Multi-agent AI architecture for intelligent code generation</li>
    <li>✅ Parallel processing support for multiple BW processes</li>
    <li>✅ Generates both REST and SOAP Spring Boot services</li>
    <li>✅ Complete Spring Boot project structure with Maven configuration</li>
    <li>✅ JAXB/XSD integration for type safety</li>
    <li>✅ JPA/Hibernate for database operations</li>
    <li>✅ JMS messaging support</li>
    <li>✅ Automated packaging and archiving</li>
</ul>

<h2>Technology Stack</h2>

<table>
    <tr>
        <th>Category</th>
        <th>Technology</th>
        <th>Version</th>
    </tr>
    <tr>
        <td>Input Format</td>
        <td>TIBCO BusinessWorks</td>
        <td>.process, .xsd, .bwp files</td>
    </tr>
    <tr>
        <td>Framework</td>
        <td>Spring Boot</td>
        <td>3.2.0</td>
    </tr>
    <tr>
        <td>Language</td>
        <td>Java</td>
        <td>17</td>
    </tr>
    <tr>
        <td>REST</td>
        <td>Spring Web</td>
        <td>Included in Spring Boot</td>
    </tr>
    <tr>
        <td>SOAP</td>
        <td>Spring Web Services</td>
        <td>Included in Spring Boot</td>
    </tr>
    <tr>
        <td>Database</td>
        <td>Spring Data JPA</td>
        <td>H2 / Oracle</td>
    </tr>
    <tr>
        <td>Messaging</td>
        <td>Spring JMS</td>
        <td>Apache Artemis</td>
    </tr>
    <tr>
        <td>XML Binding</td>
        <td>JAXB</td>
        <td>Jakarta XML Binding</td>
    </tr>
</table>

<h1 id="architecture">2. Architecture</h1>

<h2>High-Level System Architecture</h2>

<div class="diagram">
┌─────────────────────────────────────────────────────────────────┐
│                    TIBCO BW Migration System                     │
└─────────────────────────────────────────────────────────────────┘
                               │
                               ▼
        ┌──────────────────────────────────────────┐
        │         LeaderAgent (Orchestrator)        │
        │  • Discovers BW process folders          │
        │  • Builds shared knowledge base (RAG)    │
        │  • Creates ProcessAgents                 │
        │  • Manages parallel execution            │
        │  • Generates reports & archives          │
        └──────────────────────────────────────────┘
                               │
                ┌──────────────┴──────────────┐
                │                             │
                ▼                             ▼
    ┌─────────────────────┐       ┌─────────────────────┐
    │   ProcessAgent      │       │   ProcessAgent      │
    │   (Process 1)       │       │   (Process 2)       │
    │                     │       │                     │
    │ • Parse .process    │       │ • Parse .process    │
    │ • Extract XSDs      │       │ • Extract XSDs      │
    │ • Detect service    │       │ • Detect service    │
    │   types             │       │   types             │
    │ • Coordinate agents │       │ • Coordinate agents │
    └─────────────────────┘       └─────────────────────┘
                │                             │
        ┌───────┴───────┐             ┌───────┴───────┐
        ▼               ▼             ▼               ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│RestService   │ │SoapService   │ │RestService   │ │SoapService   │
│Agent         │ │Agent         │ │Agent         │ │Agent         │
│              │ │              │ │              │ │              │
│• REST API    │ │• SOAP/WSDL   │ │• REST API    │ │• SOAP/WSDL   │
│• Controller  │ │• Endpoint    │ │• Controller  │ │• Endpoint    │
│• DTOs        │ │• JAXB DTOs   │ │• DTOs        │ │• JAXB DTOs   │
│• Service     │ │• Config      │ │• Service     │ │• Config      │
└──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘
</div>

<h1 id="components">3. Component Details</h1>

<h2>3.1 LeaderAgent</h2>
<div class="feature-box">
    <p><strong>Purpose:</strong> Orchestrates the entire migration process</p>
    <p><strong>Location:</strong> <code>generator/ai/leader.py</code></p>
</div>

<h3>Key Responsibilities</h3>
<ul>
    <li>Scan input directory for BW process folders</li>
    <li>Build shared RAG (Retrieval-Augmented Generation) knowledge base</li>
    <li>Create and manage ProcessAgents for each BW folder</li>
    <li>Execute parallel or sequential processing</li>
    <li>Generate migration reports and ZIP archives</li>
</ul>

<h3>Configuration Example</h3>
<pre><code>leader = LeaderAgent(
    input_base='input_artifacts',      # BW process folder
    output_base='output',               # Generated code output
    package_root='com.example.tibco',  # Java package
    parallel=True,                      # Enable parallel processing
    max_workers=4                       # Thread pool size
)</code></pre>

<h2>3.2 ProcessAgent</h2>
<div class="feature-box">
    <p><strong>Purpose:</strong> Analyzes individual BW process and coordinates service generation</p>
    <p><strong>Location:</strong> <code>generator/ai/process_agent.py</code></p>
</div>

<h3>Key Responsibilities</h3>
<ol>
    <li>Parse <code>.process</code> files using process_parser</li>
    <li>Extract activities (JDBC, JMS, HTTP, SOAP)</li>
    <li>Identify XSD schemas</li>
    <li>Determine service type (REST vs SOAP)</li>
    <li>Generate shared artifacts (Entities, Repositories, Services, DTOs)</li>
</ol>

<h2>3.3 RestServiceAgent</h2>
<div class="feature-box">
    <p><strong>Purpose:</strong> Generates Spring Boot REST API implementation</p>
</div>

<h3>Generated Files</h3>
<ul>
    <li><code>pom.xml</code> - Maven with Spring Web dependencies</li>
    <li><code>*Controller.java</code> - @RestController with endpoints</li>
    <li><code>*Service.java</code> - @Service with business logic</li>
    <li><code>*Repository.java</code> - JpaRepository interface</li>
    <li><code>*Entity.java</code> - JPA Entity classes</li>
    <li><code>*Request.java / *Response.java</code> - DTOs</li>
    <li><code>application.yml</code> - Spring Boot configuration</li>
</ul>

<h2>3.4 SoapServiceAgent</h2>
<div class="feature-box">
    <p><strong>Purpose:</strong> Generates Spring Boot SOAP Web Service (Spring-WS)</p>
</div>

<h3>Generated Files</h3>
<ul>
    <li><code>SoapServiceApplication.java</code> - @SpringBootApplication</li>
    <li><code>WebServiceConfig.java</code> - WSDL/XSD configuration</li>
    <li><code>*Endpoint.java</code> - @Endpoint with @PayloadRoot</li>
    <li>JAXB-annotated DTOs with @XmlRootElement</li>
    <li><code>pom.xml</code> - Maven with Spring-WS dependencies</li>
    <li>Unified XSD schema files</li>
</ul>

<h1 id="setup">4. Setup Instructions</h1>

<h2>4.1 Prerequisites</h2>

<div class="warning-box">
    <h3>Required Software</h3>
    <ul>
        <li>Python 3.8 or higher</li>
        <li>Java 17 or higher (JDK)</li>
        <li>Maven 3.6+ (optional, for building generated projects)</li>
    </ul>
</div>

<h2>4.2 Installation Steps</h2>

<h3>Step 1: Navigate to Project Directory</h3>
<pre><code>cd c:\IBM\DBS-TIBCO-SPRINGBOOT\PY29OCT\tibco_migration</code></pre>

<h3>Step 2: Set Up Python Virtual Environment</h3>
<pre><code># Create virtual environment
python -m venv .venv

# Activate virtual environment (Windows PowerShell)
.venv\Scripts\activate

# Install dependencies (if requirements.txt exists)
pip install -r requirements.txt</code></pre>

<h3>Step 3: Verify Directory Structure</h3>
<pre><code>tibco_migration/
├── generator/
│   ├── generator/
│   │   ├── ai/
│   │   │   ├── leader.py
│   │   │   ├── process_agent.py
│   │   │   ├── service_agents.py
│   │   │   └── run.py
│   │   └── process_parser.py
│   ├── input_artifacts/
│   └── output/
└── MIGRATION_GUIDE.md</code></pre>

<h1 id="usage">5. Usage Examples</h1>

<h2>5.1 Basic Migration</h2>

<h3>Input Structure</h3>
<pre><code>input_artifacts/
└── LoanApp/
    ├── LoanApplication.process
    ├── loan_request.xsd
    └── loan_response.xsd</code></pre>

<h3>Run Migration</h3>
<pre><code>cd generator
python -m generator.ai.run --input-dir input_artifacts --output-dir output</code></pre>

<h3>Expected Output</h3>
<pre><code>output/
├── rest/                    # Spring Boot REST project
├── soap/                    # Spring Boot SOAP project
├── src_rest.zip            # REST source archive
├── src_soap.zip            # SOAP source archive
└── ai_migration_report.json</code></pre>

<h2>5.2 Testing REST Service</h2>

<h3>Build and Run</h3>
<pre><code>cd output\rest
mvn clean package
mvn spring-boot:run</code></pre>

<h3>Sample REST Request</h3>
<pre><code>curl -X POST http://localhost:8080/loan/apply \
  -H "Content-Type: application/json" \
  -d '{
    "customerID": "CUST001",
    "loanAmount": 50000,
    "loanType": "Personal",
    "loanTermMonths": 36,
    "applicantName": "John Doe",
    "contactEmail": "john.doe@example.com"
  }'</code></pre>

<h3>Expected Response</h3>
<pre><code>{
  "loanID": "550e8400-e29b-41d4-a716-446655440000",
  "status": "APPROVED",
  "message": "Loan application approved",
  "approvedAmount": 50000
}</code></pre>

<h2>5.3 Testing SOAP Service</h2>

<h3>Build and Run</h3>
<pre><code>cd output\soap
mvn clean package
mvn spring-boot:run</code></pre>

<h3>Access WSDL</h3>
<pre><code>http://localhost:8081/ws/loanApplication.wsdl</code></pre>

<h3>Sample SOAP Request</h3>
<pre><code>&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
                  xmlns:loan="http://example.com/tibco_migration/loan"&gt;
   &lt;soapenv:Header/&gt;
   &lt;soapenv:Body&gt;
      &lt;loan:LoanApplicationRequest&gt;
         &lt;loan:customerID&gt;CUST001&lt;/loan:customerID&gt;
         &lt;loan:loanAmount&gt;50000&lt;/loan:loanAmount&gt;
         &lt;loan:loanType&gt;Personal&lt;/loan:loanType&gt;
         &lt;loan:loanTermMonths&gt;36&lt;/loan:loanTermMonths&gt;
         &lt;loan:applicantName&gt;John Doe&lt;/loan:applicantName&gt;
         &lt;loan:contactEmail&gt;john.doe@example.com&lt;/loan:contactEmail&gt;
      &lt;/loan:LoanApplicationRequest&gt;
   &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;</code></pre>

<h1 id="flows">6. Flow Diagrams</h1>

<h2>6.1 Overall Migration Flow</h2>

<div class="diagram">
START
  │
  ├─► [1] Scan Input Directory
  │     │
  │     ├─► Find folders with .process, .xsd, .bwp files
  │     │
  │     └─► Result: List of BW process folders
  │
  ├─► [2] Build Knowledge Base (RAG)
  │     │
  │     ├─► Parse all .process files
  │     │
  │     ├─► Index activities (SQL, JMS, HTTP, etc.)
  │     │
  │     └─► Create searchable index for pattern matching
  │
  ├─► [3] Create Process Agents
  │     │
  │     └─► One ProcessAgent per BW folder
  │
  ├─► [4] Execute Processing (Parallel/Sequential)
  │     │
  │     ├─► For each ProcessAgent:
  │     │     │
  │     │     ├─► Parse .process file
  │     │     │
  │     │     ├─► Extract activities & schemas
  │     │     │
  │     │     ├─► Detect service type (REST/SOAP)
  │     │     │
  │     │     ├─► Generate REST project
  │     │     │
  │     │     └─► Generate SOAP project
  │     │
  │     └─► Collect all generated files
  │
  ├─► [5] Validate Projects
  │     │
  │     ├─► Check Maven availability
  │     │
  │     └─► Run mvn compile (optional)
  │
  ├─► [6] Package Output
  │     │
  │     ├─► Create src_rest.zip
  │     │
  │     └─► Create src_soap.zip
  │
  └─► [7] Generate Migration Report
        │
        └─► ai_migration_report.json

END
</div>

<h2>6.2 Process Agent Decision Flow</h2>

<div class="diagram">
Process Folder Received
        │
        ▼
   Parse .process File
        │
        ├─► Extract Activities
        │     ├─► JDBC operations
        │     ├─► JMS send/receive
        │     ├─► HTTP invocations
        │     └─► SOAP calls
        │
        ├─► Extract Schemas (.xsd files)
        │
        └─► Analyze Service Type
              │
              ├─► Contains HTTP activities? ──► REST Service
              │
              ├─► Contains SOAP activities? ──► SOAP Service
              │
              └─► Default ──────────────────► Both REST & SOAP
                    │
                    ├─► Generate REST Project
                    │     └─► RestServiceAgent.generate()
                    │
                    └─► Generate SOAP Project
                          └─► SoapServiceAgent.generate()
</div>

<h1 id="sequences">7. Sequence Diagrams</h1>

<h2>7.1 REST Service Request Flow</h2>

<div class="diagram">
Client → Controller → Service → Repository → Database
   │         │          │           │           │
   │ POST    │          │           │           │
   ├────────►│          │           │           │
   │         │ apply()  │           │           │
   │         ├─────────►│           │           │
   │         │          │ save()    │           │
   │         │          ├──────────►│           │
   │         │          │           │ INSERT    │
   │         │          │           ├──────────►│
   │         │          │           │◄──────────┤
   │         │          │◄──────────┤           │
   │         │          │           │           │
   │         │          │ creditCheck()         │
   │         │          ├────────►  │           │
   │         │          │◄───────┘  │           │
   │         │          │           │           │
   │         │◄─────────┤           │           │
   │◄────────┤ response │           │           │
   │ 200 OK  │          │           │           │
</div>

<h1 id="outputs">8. Generated Outputs</h1>

<h2>8.1 REST Service Structure</h2>

<div class="success-box">
<pre><code>output/rest/
├── pom.xml
├── src/main/java/com/example/tibco_migration/
│   ├── controller/
│   │   └── LoanApplicationController.java
│   ├── service/
│   │   └── LoanApplicationService.java
│   ├── repository/
│   │   └── LoanRepository.java
│   ├── entity/
│   │   └── LoanEntity.java
│   └── dto/
│       ├── LoanApplicationRequest.java
│       └── LoanApplicationResponse.java
└── src/main/resources/
    ├── application.yml
    └── xsd/
        ├── loan_request.xsd
        └── loan_response.xsd</code></pre>
</div>

<h2>8.2 SOAP Service Structure</h2>

<div class="success-box">
<pre><code>output/soap/
├── pom.xml
├── src/main/java/com/example/tibco_migration/
│   ├── SoapServiceApplication.java
│   ├── config/
│   │   ├── WebServiceConfig.java
│   │   └── WebClientConfig.java
│   ├── endpoint/
│   │   └── LoanApplicationEndpoint.java
│   ├── service/
│   │   └── LoanApplicationService.java
│   ├── repository/
│   │   └── LoanRepository.java
│   ├── entity/
│   │   └── LoanEntity.java
│   └── dto/
│       ├── LoanApplicationRequest.java (JAXB)
│       └── LoanApplicationResponse.java (JAXB)
└── src/main/resources/
    ├── application.yml
    └── xsd/
        └── loan_request.xsd</code></pre>
</div>

<h1 id="troubleshooting">9. Troubleshooting</h1>

<h2>Common Issues and Solutions</h2>

<table>
    <tr>
        <th>Issue</th>
        <th>Symptom</th>
        <th>Solution</th>
    </tr>
    <tr>
        <td>AI Libraries Not Available</td>
        <td>Warning: "No module named 'numpy'"</td>
        <td>Normal operation. System uses fallback mode. Optional: <code>pip install numpy scikit-learn</code></td>
    </tr>
    <tr>
        <td>Maven Not Found</td>
        <td>"Maven executable not found"</td>
        <td>Install Maven or skip validation: <code>choco install maven</code></td>
    </tr>
    <tr>
        <td>Port Already in Use</td>
        <td>"Port 8080 is already in use"</td>
        <td>Change port in <code>application.yml</code>: <code>server.port: 8090</code></td>
    </tr>
    <tr>
        <td>JAXB Classes Not Generated</td>
        <td>"Cannot find generated JAXB classes"</td>
        <td>Run: <code>mvn clean compile</code></td>
    </tr>
    <tr>
        <td>WSDL Not Accessible</td>
        <td>"404 Not Found for WSDL"</td>
        <td>Verify XSD exists in <code>src/main/resources/xsd/</code></td>
    </tr>
</table>

<h2>Debug Mode</h2>

<div class="warning-box">
<p>Enable detailed logging in <code>application.yml</code>:</p>
<pre><code>logging:
  level:
    org.springframework.ws: DEBUG
    com.example.tibco_migration: DEBUG
    org.springframework.jms: DEBUG
    org.springframework.data.jpa: DEBUG</code></pre>
</div>

<h1 id="ai-enablement">10. Enabling AI-Powered Code Generation</h1>

<div class="feature-box">
<p><strong>Current Status:</strong> The framework uses <strong>template-based code generation</strong> (fast, deterministic, no API costs). You can optionally enable <strong>AI-powered generation</strong> for more intelligent, context-aware code.</p>
</div>

<h2>Current Architecture</h2>

<h3>Template-Based (Active)</h3>
<ul>
    <li>✅ Uses predefined Python string templates</li>
    <li>✅ Fast and reliable</li>
    <li>✅ No external dependencies</li>
    <li>✅ Generates consistent, predictable code</li>
    <li>✅ No API costs</li>
</ul>

<h3>AI-Ready Design</h3>
<ul>
    <li>🤖 Multi-agent architecture ready for LLM integration</li>
    <li>🤖 RAG (Retrieval Augmented Generation) module already implemented</li>
    <li>🤖 Vector database (FAISS) support built-in</li>
    <li>🤖 Falls back to templates if AI libraries unavailable</li>
</ul>

<h2>How to Enable AI Features</h2>

<h3>Step 1: Install AI Dependencies</h3>

<p>Add to <code>requirements.txt</code>:</p>
<pre><code># AI/ML Dependencies (optional)
openai==1.3.0              # For LLM API calls
sentence-transformers      # For embeddings
faiss-cpu                  # Vector database (use faiss-gpu for GPU)
numpy                      # Mathematical operations</code></pre>

<p>Install:</p>
<pre><code>pip install -r requirements.txt</code></pre>

<div class="success-box">
<p><strong>Note:</strong> The <code>rag.py</code> module automatically detects these libraries and switches from fallback mode to AI mode!</p>
</div>

<h3>Step 2: Set Up OpenAI API Key</h3>

<pre><code># Windows PowerShell
$env:OPENAI_API_KEY="sk-your-api-key-here"

# Linux/Mac
export OPENAI_API_KEY="sk-your-api-key-here"</code></pre>

<h3>Step 3: Enable RAG (Vector Search)</h3>

<p>Once dependencies are installed, RAG works automatically:</p>
<pre><code>from generator.ai.rag import ProcessKnowledgeBase

kb = ProcessKnowledgeBase()
kb.index_process_activities("input/LoanApplication.process")
similar = kb.query_similar_activities("SQL activity with parameterized query", k=5)</code></pre>

<h2>AI vs Template Comparison</h2>

<table>
    <tr>
        <th>Feature</th>
        <th>Template-Based</th>
        <th>AI-Powered</th>
    </tr>
    <tr>
        <td>Speed</td>
        <td>⚡ Very Fast (&lt;1s)</td>
        <td>🐌 Slower (5-10s per service)</td>
    </tr>
    <tr>
        <td>Cost</td>
        <td>💰 Free</td>
        <td>💵 ~$0.01-0.10 per service</td>
    </tr>
    <tr>
        <td>Consistency</td>
        <td>✅ Identical output</td>
        <td>⚠️ Varies slightly</td>
    </tr>
    <tr>
        <td>Intelligence</td>
        <td>📋 Fixed patterns</td>
        <td>🧠 Context-aware</td>
    </tr>
    <tr>
        <td>Dependencies</td>
        <td>✅ Python only</td>
        <td>📦 OpenAI API, ML libraries</td>
    </tr>
    <tr>
        <td>Customization</td>
        <td>📝 Edit templates</td>
        <td>💬 Prompt engineering</td>
    </tr>
    <tr>
        <td>Best For</td>
        <td>Standard migrations</td>
        <td>Complex, unique patterns</td>
    </tr>
</table>

<h2>When to Use AI</h2>

<div class="success-box">
<h3>✅ Use AI-powered generation when:</h3>
<ul>
    <li>TIBCO processes have complex, unique business logic</li>
    <li>You need intelligent mapping of custom activities</li>
    <li>Processes use uncommon patterns</li>
    <li>You want to leverage historical migration knowledge</li>
</ul>
</div>

<div class="warning-box">
<h3>❌ Use template-based generation when:</h3>
<ul>
    <li>Processes follow standard patterns</li>
    <li>Speed is critical</li>
    <li>You want predictable, consistent output</li>
    <li>No OpenAI API access or budget constraints</li>
</ul>
</div>

<h2>RAG Vector Database Details</h2>

<table>
    <tr>
        <th>Aspect</th>
        <th>Details</th>
    </tr>
    <tr>
        <td>Technology</td>
        <td>FAISS (Facebook AI Similarity Search)</td>
    </tr>
    <tr>
        <td>Type</td>
        <td>In-memory vector database</td>
    </tr>
    <tr>
        <td>Dimensions</td>
        <td>384 (model: all-MiniLM-L6-v2)</td>
    </tr>
    <tr>
        <td>Purpose</td>
        <td>Store TIBCO activity embeddings for similarity search</td>
    </tr>
    <tr>
        <td>Use Case</td>
        <td>Find similar activities across multiple BW processes</td>
    </tr>
</table>

<h3>How RAG Works:</h3>
<ol>
    <li>Parse TIBCO <code>.process</code> files and extract activities</li>
    <li>Convert activity metadata to text representations</li>
    <li>Generate embeddings using sentence-transformers</li>
    <li>Store in FAISS index for fast similarity search</li>
    <li>Query during code generation to find similar patterns</li>
</ol>

<h2>Cost Estimation (AI Mode)</h2>

<table>
    <tr>
        <th>Item</th>
        <th>Cost</th>
    </tr>
    <tr>
        <td>OpenAI GPT-4 Input</td>
        <td>~$0.03 per 1K tokens</td>
    </tr>
    <tr>
        <td>OpenAI GPT-4 Output</td>
        <td>~$0.06 per 1K tokens</td>
    </tr>
    <tr>
        <td>Average per service</td>
        <td><strong>~$0.12</strong></td>
    </tr>
    <tr>
        <td>For 10 BW processes</td>
        <td>~$1.20</td>
    </tr>
    <tr>
        <td>For 100 BW processes</td>
        <td>~$12.00</td>
    </tr>
    <tr>
        <td>Template mode</td>
        <td><strong>$0</strong> (no API calls)</td>
    </tr>
</table>

<h2>Migration Path: Template → AI</h2>

<div class="feature-box">
<p><strong>You don't need to rewrite everything!</strong> The framework supports <strong>hybrid mode</strong>:</p>
<ol>
    <li><strong>Phase 1:</strong> Use templates for standard services (90% of processes)</li>
    <li><strong>Phase 2:</strong> Enable AI only for complex processes with <code>--use-ai</code> flag</li>
    <li><strong>Phase 3:</strong> Gradually enhance with LLM where templates fall short</li>
</ol>
<p><strong>No breaking changes</strong> - templates remain as fallback!</p>
</div>

<h1 id="hexagonal">11. Hexagonal Architecture Support</h1>

<div class="feature-box">
<p>The framework now supports <strong>two architectural patterns</strong> for generating Spring Boot services:</p>
<ol>
    <li><strong>Layered Architecture</strong> (Default) - Traditional controller → service → repository structure</li>
    <li><strong>Hexagonal Architecture</strong> (New) - Ports & Adapters pattern with domain-driven design</li>
</ol>
</div>

<h2>11.1 Architecture Comparison</h2>

<table>
    <tr>
        <th>Aspect</th>
        <th>Layered Architecture</th>
        <th>Hexagonal Architecture</th>
    </tr>
    <tr>
        <td><strong>Structure</strong></td>
        <td>Controller → Service → Repository</td>
        <td>Domain (Ports) ← Adapters</td>
    </tr>
    <tr>
        <td><strong>Dependencies</strong></td>
        <td>Top-down (Controller depends on Service)</td>
        <td>Inward (Adapters depend on Domain)</td>
    </tr>
    <tr>
        <td><strong>Domain Purity</strong></td>
        <td>Domain mixed with framework code</td>
        <td>Domain has ZERO framework dependencies</td>
    </tr>
    <tr>
        <td><strong>Testability</strong></td>
        <td>Requires mocking Spring components</td>
        <td>Pure unit tests without Spring</td>
    </tr>
    <tr>
        <td><strong>Technology Coupling</strong></td>
        <td>Tight coupling to Spring</td>
        <td>Loose coupling via interfaces</td>
    </tr>
    <tr>
        <td><strong>Best For</strong></td>
        <td>Standard CRUD services</td>
        <td>Complex business logic, DDD</td>
    </tr>
    <tr>
        <td><strong>Generated Projects</strong></td>
        <td>Separate REST and SOAP projects</td>
        <td>Single project with multiple adapters</td>
    </tr>
</table>

<h2>11.2 Hexagonal Architecture Overview</h2>

<div class="diagram">
┌─────────────────────────────────────────────────────────────────┐
│               Hexagonal Architecture (Ports & Adapters)          │
└─────────────────────────────────────────────────────────────────┘

                ┌──────────────────────┐
                │    REST Adapter      │
                │   (Controller)       │
                └──────────┬───────────┘
                           │
                ┌──────────▼───────────┐
                │   SOAP Adapter       │
                │   (Endpoint)         │
                └──────────┬───────────┘
                           │
     ┌─────────────────────┼─────────────────────┐
     │                     │                     │
     │        INPUT PORTS (Interfaces)           │
     │     ┌───────────────▼───────────────┐     │
     │     │   LoanApplicationUseCase      │     │
     │     │   (Interface)                 │     │
     │     └───────────────┬───────────────┘     │
     │                     │                     │
     │        ┌────────────▼────────────┐        │
     │        │    DOMAIN LAYER         │        │
     │        │  (Pure Business Logic)  │        │
     │        │                         │        │
     │        │ • LoanApplication       │        │
     │        │ • ApplicantInfo         │        │
     │        │ • CreditScore           │        │
     │        │ • LoanStatus            │        │
     │        │                         │        │
     │        │ LoanApplicationService  │        │
     │        │ (implements UseCase)    │        │
     │        └────────────┬────────────┘        │
     │                     │                     │
     │        OUTPUT PORTS (Interfaces)          │
     │     ┌───────────────┼───────────────┐     │
     │     │ • LoanRepository              │     │
     │     │ • CreditScoreGateway          │     │
     │     │ • NotificationGateway         │     │
     │     └───────────────┬───────────────┘     │
     │                     │                     │
     └─────────────────────┼─────────────────────┘
                           │
     ┌─────────────────────┼─────────────────────┐
     │                     │                     │
     │        OUTPUT ADAPTERS                    │
     │                     │                     │
┌────▼─────┐     ┌────────▼────────┐     ┌──────▼──────┐
│   JPA    │     │  HTTP Gateway   │     │     JMS     │
│ Adapter  │     │    (WebClient)  │     │   Adapter   │
│(Database)│     │(External APIs)  │     │(Messaging)  │
└──────────┘     └─────────────────┘     └─────────────┘
</div>

<h3>Key Principles</h3>

<div class="success-box">
<p><strong>1. Domain Independence:</strong></p>
<ul>
    <li>Domain models have NO Spring annotations</li>
    <li>Pure Java POJOs representing business concepts</li>
    <li>No framework dependencies (@Entity, @Component, etc.)</li>
</ul>

<p><strong>2. Dependency Inversion:</strong></p>
<ul>
    <li>Domain defines interfaces (ports)</li>
    <li>Adapters implement those interfaces</li>
    <li>Dependencies point INWARD toward domain</li>
</ul>

<p><strong>3. Adapter Flexibility:</strong></p>
<ul>
    <li>Multiple input adapters (REST, SOAP, CLI) can use same domain</li>
    <li>Output adapters (JPA, MongoDB, external APIs) are swappable</li>
    <li>Change technology without touching domain logic</li>
</ul>
</div>

<h2>11.3 Usage Examples</h2>

<h3>Generate Hexagonal Architecture (Combined REST + SOAP)</h3>
<pre><code>python -m generator.ai.run \
  --input-dir input_artifacts \
  --output-dir output \
  --architecture hexagonal \
  --service-type combined
</code></pre>

<p><strong>Output:</strong></p>
<ul>
    <li>Single Spring Boot project with both REST and SOAP adapters</li>
    <li>Shared domain logic</li>
    <li>Both adapters call same use case</li>
</ul>

<h3>Generate Hexagonal Architecture (REST Only)</h3>
<pre><code>python -m generator.ai.run \
  --input-dir input_artifacts \
  --output-dir output \
  --architecture hexagonal \
  --service-type rest
</code></pre>

<p><strong>Output:</strong></p>
<ul>
    <li>Only REST adapter included in project</li>
    <li>Lighter pom.xml (no Spring-WS dependencies)</li>
    <li>Still follows hexagonal pattern</li>
</ul>

<h3>Generate Traditional Layered Architecture (Default)</h3>
<pre><code>python -m generator.ai.run \
  --input-dir input_artifacts \
  --output-dir output
  # --architecture layered (default, can be omitted)
</code></pre>

<p><strong>Output:</strong></p>
<ul>
    <li>Separate REST and SOAP projects</li>
    <li>Traditional structure (backward compatible)</li>
</ul>

<h2>11.4 Code Examples</h2>

<h3>Domain Model (Pure Java)</h3>
<pre><code>// domain/model/LoanApplication.java
package com.example.tibco_migration.domain.model;

// NO Spring annotations! Pure business entity
public class LoanApplication {
    private String loanID;
    private String customerID;
    private double loanAmount;
    private LoanStatus status;
    
    // Business methods
    public void approve(double amount) {
        this.status = LoanStatus.APPROVED;
        this.loanAmount = amount;
    }
    
    public boolean requiresCreditCheck() {
        return loanAmount > 10000;
    }
}
</code></pre>

<h3>Input Port (Use Case Interface)</h3>
<pre><code>// domain/port/in/LoanApplicationUseCase.java
package com.example.tibco_migration.domain.port.in;

// Domain-defined interface (NO Spring!)
public interface LoanApplicationUseCase {
    LoanApplication applyForLoan(LoanApplication application);
    LoanApplication getLoanStatus(String loanID);
}
</code></pre>

<h3>Domain Service (Business Logic)</h3>
<pre><code>// domain/service/LoanApplicationService.java
package com.example.tibco_migration.domain.service;

// Pure business logic - NO @Service annotation!
public class LoanApplicationService implements LoanApplicationUseCase {
    private final LoanRepository loanRepository;
    private final CreditScoreGateway creditScoreGateway;
    
    public LoanApplicationService(
        LoanRepository loanRepository,
        CreditScoreGateway creditScoreGateway
    ) {
        this.loanRepository = loanRepository;
        this.creditScoreGateway = creditScoreGateway;
    }
    
    @Override
    public LoanApplication applyForLoan(LoanApplication application) {
        if (application.requiresCreditCheck()) {
            CreditScore score = creditScoreGateway.checkCredit(
                application.getCustomerID()
            );
            
            if (score.getScore() > 700) {
                application.approve(application.getLoanAmount());
            }
        }
        
        return loanRepository.save(application);
    }
}
</code></pre>

<h3>REST Adapter (Input)</h3>
<pre><code>// adapter/in/rest/controller/LoanController.java
package com.example.tibco_migration.adapter.in.rest.controller;

import org.springframework.web.bind.annotation.*;

@RestController  // Spring annotation in ADAPTER only
@RequestMapping("/api/loans")
public class LoanController {
    private final LoanApplicationUseCase loanUseCase;  // Depends on PORT
    
    @PostMapping("/apply")
    public LoanResponseDto apply(@RequestBody LoanRequestDto dto) {
        // Convert DTO → Domain
        LoanApplication domain = mapper.toDomain(dto);
        
        // Call use case (domain logic)
        LoanApplication result = loanUseCase.applyForLoan(domain);
        
        // Convert Domain → DTO
        return mapper.toDto(result);
    }
}
</code></pre>

<h2>11.5 Benefits</h2>

<table>
    <tr>
        <th>Benefit</th>
        <th>Description</th>
        <th>Example</th>
    </tr>
    <tr>
        <td><strong>Testability</strong></td>
        <td>Test domain logic without Spring</td>
        <td>No @SpringBootTest needed - pure JUnit</td>
    </tr>
    <tr>
        <td><strong>Technology Independence</strong></td>
        <td>Swap frameworks without changing business logic</td>
        <td>Change from JPA to MongoDB - only adapter changes</td>
    </tr>
    <tr>
        <td><strong>Domain Focus</strong></td>
        <td>Business rules in pure Java</td>
        <td>Domain experts can read code without framework knowledge</td>
    </tr>
    <tr>
        <td><strong>Multiple Interfaces</strong></td>
        <td>Same domain, multiple adapters</td>
        <td>REST + SOAP + GraphQL using same business logic</td>
    </tr>
    <tr>
        <td><strong>Clear Boundaries</strong></td>
        <td>Explicit separation of concerns</td>
        <td>Ports define contracts between layers</td>
    </tr>
</table>

<h2>11.6 When to Use Each Architecture</h2>

<h3>✅ Use Layered Architecture When:</h3>
<div class="success-box">
<ul>
    <li>Simple CRUD operations</li>
    <li>Standard REST/SOAP services</li>
    <li>Team familiar with Spring Boot conventions</li>
    <li>Quick prototypes</li>
    <li>Small services with minimal business logic</li>
</ul>
</div>

<h3>✅ Use Hexagonal Architecture When:</h3>
<div class="feature-box">
<ul>
    <li>Complex business logic (DDD approach)</li>
    <li>Need to support multiple protocols (REST + SOAP + CLI)</li>
    <li>High testability requirements</li>
    <li>Technology might change (database, messaging, etc.)</li>
    <li>Long-term maintainability is critical</li>
    <li>Domain-driven design principles</li>
    <li>Team experienced with ports & adapters pattern</li>
</ul>
</div>

<h2>11.7 Generated Structure (Hexagonal)</h2>

<div class="diagram">
output/hexagonal/
│
├── pom.xml                          # Conditional dependencies
├── src/main/java/com/example/tibco_migration/
│   ├── HexagonalServiceApplication.java     # @SpringBootApplication
│   │
│   ├── domain/                              # PURE DOMAIN
│   │   ├── model/                           # No framework deps
│   │   │   ├── LoanApplication.java
│   │   │   ├── ApplicantInfo.java
│   │   │   └── LoanStatus.java
│   │   ├── port/
│   │   │   ├── in/                          # INPUT PORTS
│   │   │   │   └── LoanApplicationUseCase.java
│   │   │   └── out/                         # OUTPUT PORTS
│   │   │       ├── LoanRepository.java
│   │   │       ├── CreditScoreGateway.java
│   │   │       └── NotificationGateway.java
│   │   └── service/
│   │       └── LoanApplicationService.java  # Business logic
│   │
│   ├── adapter/                             # ADAPTERS
│   │   ├── in/                              # INPUT ADAPTERS
│   │   │   ├── rest/                        # REST Adapter
│   │   │   │   ├── controller/
│   │   │   │   ├── dto/
│   │   │   │   └── mapper/
│   │   │   └── soap/                        # SOAP Adapter
│   │   │       ├── endpoint/
│   │   │       ├── dto/
│   │   │       └── config/
│   │   └── out/                             # OUTPUT ADAPTERS
│   │       ├── persistence/                 # JPA Adapter
│   │       ├── http/                        # HTTP Gateway
│   │       └── jms/                         # JMS Adapter
│   └── config/
└── src/main/resources/
    └── application.yml
</div>

<h2>11.8 Build and Run Hexagonal Service</h2>

<pre><code># Build
cd output/hexagonal
mvn clean package

# Run
java -jar target/hexagonal-loan-service-0.1.0.jar
</code></pre>

<p><strong>Access:</strong></p>
<ul>
    <li>REST API: <code>http://localhost:8080/api/loans/apply</code></li>
    <li>SOAP WSDL: <code>http://localhost:8080/ws/loanApplication.wsdl</code> (if SOAP enabled)</li>
</ul>

<h1>Quick Reference</h1>

<h2>Command Summary</h2>

<table>
    <tr>
        <th>Action</th>
        <th>Command</th>
    </tr>
    <tr>
        <td>Run Migration</td>
        <td><code>python -m generator.ai.run --input-dir input_artifacts --output-dir output</code></td>
    </tr>
    <tr>
        <td>Build REST Service</td>
        <td><code>cd output/rest && mvn clean package</code></td>
    </tr>
    <tr>
        <td>Build SOAP Service</td>
        <td><code>cd output/soap && mvn clean package</code></td>
    </tr>
    <tr>
        <td>Run REST Service</td>
        <td><code>mvn spring-boot:run</code> (in rest folder)</td>
    </tr>
    <tr>
        <td>Run SOAP Service</td>
        <td><code>mvn spring-boot:run</code> (in soap folder)</td>
    </tr>
</table>

<h2>Service URLs</h2>

<table>
    <tr>
        <th>Service</th>
        <th>URL</th>
    </tr>
    <tr>
        <td>REST API</td>
        <td><code>http://localhost:8080</code></td>
    </tr>
    <tr>
        <td>SOAP WSDL</td>
        <td><code>http://localhost:8081/ws/loanApplication.wsdl</code></td>
    </tr>
    <tr>
        <td>H2 Console (REST)</td>
        <td><code>http://localhost:8080/h2-console</code></td>
    </tr>
    <tr>
        <td>H2 Console (SOAP)</td>
        <td><code>http://localhost:8081/h2-console</code></td>
    </tr>
</table>

<h1 id="api-gateway">API Gateway (Spring Cloud Gateway)</h1>

<div class="info-box">
    <strong>Overview:</strong> Spring Cloud Gateway provides a unified entry point for all microservices with advanced routing, circuit breaking, rate limiting, and monitoring capabilities.
</div>

<h2>Features</h2>

<table>
    <tr>
        <th>Feature</th>
        <th>Description</th>
        <th>Configuration</th>
    </tr>
    <tr>
        <td><strong>Path-based Routing</strong></td>
        <td>Routes requests based on URL patterns</td>
        <td><code>/api/**</code> (REST), <code>/ws/**</code> (SOAP)</td>
    </tr>
    <tr>
        <td><strong>Circuit Breaker</strong></td>
        <td>Fault tolerance with Resilience4j</td>
        <td>50% failure threshold, 10s wait</td>
    </tr>
    <tr>
        <td><strong>Rate Limiting</strong></td>
        <td>Prevent API abuse (Redis-based)</td>
        <td>IP or user-based key resolvers</td>
    </tr>
    <tr>
        <td><strong>CORS</strong></td>
        <td>Cross-origin resource sharing</td>
        <td>Configurable origins, methods, headers</td>
    </tr>
    <tr>
        <td><strong>Retry Mechanism</strong></td>
        <td>Automatic request retry</td>
        <td>3 attempts per failed request</td>
    </tr>
    <tr>
        <td><strong>Load Balancing</strong></td>
        <td>Distribute traffic across instances</td>
        <td>Built-in with service discovery</td>
    </tr>
    <tr>
        <td><strong>Monitoring</strong></td>
        <td>Actuator endpoints</td>
        <td>Health, routes, metrics, prometheus</td>
    </tr>
</table>

<h2>Architecture Diagram</h2>

<pre style="background: #f8f9fa; border: 2px solid #3498db;">
┌──────────────────────────────────────────────────────────────┐
│                   External Clients                            │
│      (Web Apps, Mobile Apps, Third-party Systems)             │
└──────────────┬───────────────────────────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────────────────────────┐
│          API Gateway (Spring Cloud Gateway)                   │
│                   Port: 8080                                  │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ • Path-based routing (/api/**, /ws/**)                │  │
│  │ • Circuit breaker (Resilience4j)                      │  │
│  │ • Rate limiting (Redis)                               │  │
│  │ • CORS configuration                                  │  │
│  │ • Request/response filtering                          │  │
│  │ • Monitoring (Actuator)                               │  │
│  └────────────────────────────────────────────────────────┘  │
└──────────┬─────────────┬─────────────┬────────────────────────┘
           │             │             │
           ▼             ▼             ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────────────────┐
│ REST Service │ │ SOAP Service │ │ Hexagonal Service        │
│ (Layered)    │ │ (Layered)    │ │ (Ports & Adapters)       │
│ Port: 8081   │ │ Port: 8082   │ │ Port: 8083               │
└──────────────┘ └──────────────┘ └──────────────────────────┘
</pre>

<h2>Generated Components</h2>

<h3>1. Gateway Application</h3>

<pre><code class="language-java">@SpringBootApplication
public class ApiGatewayApplication {
    public static void main(String[] args) {
        SpringApplication.run(ApiGatewayApplication.class, args);
    }
}</code></pre>

<h3>2. Route Configuration</h3>

<div class="success-box">
    <strong>Auto-configured Routes:</strong> Gateway automatically configures routes for all generated services based on their type and architecture.
</div>

<pre><code class="language-java">@Configuration
public class RouteConfig {
    @Bean
    public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {
        return builder.routes()
            // REST service route
            .route("loan_rest_route", r -> r
                .path("/api/loanapplication/**")
                .filters(f -> f
                    .stripPrefix(1)
                    .addRequestHeader("X-Gateway-Route", "loan_rest")
                    .circuitBreaker(c -> c
                        .setName("loan_cb")
                        .setFallbackUri("forward:/fallback/loan"))
                    .retry(config -> config.setRetries(3)))
                .uri("http://localhost:8081"))
            
            // SOAP service route
            .route("loan_soap_route", r -> r
                .path("/ws/loanapplication/**")
                .filters(f -> f
                    .stripPrefix(1)
                    .circuitBreaker(c -> c
                        .setName("loan_soap_cb")))
                .uri("http://localhost:8081"))
            .build();
    }
}</code></pre>

<h3>3. CORS Configuration</h3>

<pre><code class="language-java">@Configuration
public class CorsConfig {
    @Bean
    public CorsWebFilter corsWebFilter() {
        CorsConfiguration corsConfig = new CorsConfiguration();
        corsConfig.setAllowedOriginPatterns(List.of("*"));
        corsConfig.setAllowedMethods(Arrays.asList(
            "GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"
        ));
        corsConfig.setAllowedHeaders(Arrays.asList(
            "Authorization", "Content-Type", "X-User-Id"
        ));
        corsConfig.setAllowCredentials(true);
        corsConfig.setMaxAge(3600L);
        
        UrlBasedCorsConfigurationSource source = 
            new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", corsConfig);
        return new CorsWebFilter(source);
    }
}</code></pre>

<h3>4. Gateway Configuration</h3>

<pre><code class="language-yaml">spring:
  application:
    name: api-gateway
  
  cloud:
    gateway:
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
      
      httpclient:
        connect-timeout: 5000
        response-timeout: 30s

server:
  port: 8080

resilience4j:
  circuitbreaker:
    configs:
      default:
        slidingWindowSize: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 10s</code></pre>

<h2>Usage</h2>

<h3>Generate Gateway</h3>

<div class="code-block">
<pre><code class="language-bash"># With layered architecture
python -m generator.ai.run \
  --input-dir input_artifacts \
  --output-dir output \
  --gateway

# With hexagonal architecture
python -m generator.ai.run \
  --input-dir input_artifacts \
  --output-dir output \
  --architecture hexagonal \
  --service-type combined \
  --gateway</code></pre>
</div>

<h3>Run Gateway and Services</h3>

<div class="warning-box">
    <strong>Important:</strong> Start backend services before starting the gateway.
</div>

<table>
    <tr>
        <th>Step</th>
        <th>Command</th>
        <th>Port</th>
    </tr>
    <tr>
        <td>1. Start Backend Service</td>
        <td><code>cd output/hexagonal && mvn spring-boot:run</code></td>
        <td>8081</td>
    </tr>
    <tr>
        <td>2. Start API Gateway</td>
        <td><code>cd output/api-gateway && mvn spring-boot:run</code></td>
        <td>8080</td>
    </tr>
    <tr>
        <td>3. Access via Gateway</td>
        <td><code>curl http://localhost:8080/api/loan/apply</code></td>
        <td>8080</td>
    </tr>
</table>

<h2>Route Patterns</h2>

<table>
    <tr>
        <th>Service Type</th>
        <th>Pattern</th>
        <th>Example</th>
        <th>Backend</th>
    </tr>
    <tr>
        <td>REST (Layered)</td>
        <td><code>/api/{service}/**</code></td>
        <td><code>/api/loanapplication/**</code></td>
        <td>http://localhost:8081</td>
    </tr>
    <tr>
        <td>SOAP (Layered)</td>
        <td><code>/ws/{service}/**</code></td>
        <td><code>/ws/loanapplication/**</code></td>
        <td>http://localhost:8082</td>
    </tr>
    <tr>
        <td>Hexagonal (REST)</td>
        <td><code>/api/{service}/**</code></td>
        <td><code>/api/loanprocess/**</code></td>
        <td>http://localhost:8083</td>
    </tr>
    <tr>
        <td>Hexagonal (SOAP)</td>
        <td><code>/ws/{service}/**</code></td>
        <td><code>/ws/loanprocess/**</code></td>
        <td>http://localhost:8083</td>
    </tr>
    <tr>
        <td>Hexagonal (Combined)</td>
        <td>Both patterns</td>
        <td>Both REST & SOAP</td>
        <td>http://localhost:8083</td>
    </tr>
</table>

<h2>Monitoring Endpoints</h2>

<table>
    <tr>
        <th>Endpoint</th>
        <th>Description</th>
        <th>Example</th>
    </tr>
    <tr>
        <td><code>/actuator/health</code></td>
        <td>Gateway health status</td>
        <td><code>curl http://localhost:8080/actuator/health</code></td>
    </tr>
    <tr>
        <td><code>/actuator/gateway/routes</code></td>
        <td>List all configured routes</td>
        <td>Shows all route definitions</td>
    </tr>
    <tr>
        <td><code>/actuator/metrics</code></td>
        <td>Gateway metrics</td>
        <td>Response times, error rates</td>
    </tr>
    <tr>
        <td><code>/actuator/gateway/routes/{id}</code></td>
        <td>Specific route details</td>
        <td>Route configuration by ID</td>
    </tr>
    <tr>
        <td><code>/actuator/gateway/refresh</code></td>
        <td>Refresh routes</td>
        <td>Reload route configuration</td>
    </tr>
</table>

<h2>Circuit Breaker Details</h2>

<div class="info-box">
    <strong>Configuration:</strong> Each route is protected with a circuit breaker for fault tolerance.
</div>

<table>
    <tr>
        <th>Parameter</th>
        <th>Value</th>
        <th>Description</th>
    </tr>
    <tr>
        <td>Sliding Window Size</td>
        <td>10 calls</td>
        <td>Number of calls to track</td>
    </tr>
    <tr>
        <td>Failure Rate Threshold</td>
        <td>50%</td>
        <td>Percentage to open circuit</td>
    </tr>
    <tr>
        <td>Wait Duration</td>
        <td>10 seconds</td>
        <td>Time in open state</td>
    </tr>
    <tr>
        <td>Half-Open Calls</td>
        <td>3 calls</td>
        <td>Test calls in half-open state</td>
    </tr>
</table>

<h2>Rate Limiting</h2>

<div class="warning-box">
    <strong>Requires Redis:</strong> Rate limiting needs a running Redis instance.
</div>

<h3>IP-based Rate Limiting</h3>

<pre><code class="language-java">@Bean
public KeyResolver ipKeyResolver() {
    return exchange -> Mono.just(
        exchange.getRequest()
            .getRemoteAddress()
            .getAddress()
            .getHostAddress()
    );
}</code></pre>

<h3>User-based Rate Limiting</h3>

<pre><code class="language-java">@Bean
public KeyResolver userKeyResolver() {
    return exchange -> Mono.justOrEmpty(
        exchange.getRequest()
            .getHeaders()
            .getFirst("X-User-Id")
    ).defaultIfEmpty("anonymous");
}</code></pre>

<h3>Configuration Example</h3>

<pre><code class="language-yaml">spring:
  cloud:
    gateway:
      routes:
        - id: loan_service
          filters:
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10  # req/sec
                redis-rate-limiter.burstCapacity: 20  # max burst
                key-resolver: "#{@ipKeyResolver}"</code></pre>

<h2>Production Considerations</h2>

<div class="success-box">
    <strong>Best Practices:</strong> Follow these recommendations for production deployments.
</div>

<h3>1. CORS Security</h3>

<pre><code class="language-java">// Restrict to specific domains
corsConfig.setAllowedOrigins(Arrays.asList(
    "https://app.example.com",
    "https://admin.example.com"
));</code></pre>

<h3>2. SSL/TLS</h3>

<pre><code class="language-yaml">server:
  port: 8443
  ssl:
    enabled: true
    key-store: classpath:keystore.p12
    key-store-password: ${KEYSTORE_PASSWORD}
    key-store-type: PKCS12</code></pre>

<h3>3. Service Discovery</h3>

<pre><code class="language-yaml">spring:
  cloud:
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true</code></pre>

<h3>4. Authentication</h3>

<pre><code class="language-java">.filters(f -> f
    .filter(authenticationFilter)
    .stripPrefix(1))</code></pre>

<h2>Troubleshooting</h2>

<table>
    <tr>
        <th>Issue</th>
        <th>Solution</th>
    </tr>
    <tr>
        <td><strong>Route Not Found (404)</strong></td>
        <td>
            • Check routes: <code>curl http://localhost:8080/actuator/gateway/routes</code><br>
            • Verify backend service is running<br>
            • Review gateway logs
        </td>
    </tr>
    <tr>
        <td><strong>Circuit Breaker Open</strong></td>
        <td>
            • Check backend service health<br>
            • View metrics: <code>/actuator/metrics/resilience4j.circuitbreaker.state</code><br>
            • Adjust threshold in application.yml
        </td>
    </tr>
    <tr>
        <td><strong>CORS Errors</strong></td>
        <td>
            • Verify CorsConfig allows required origins<br>
            • Check browser console for specific errors<br>
            • Test preflight: <code>curl -X OPTIONS -H "Origin: http://localhost:3000" -v</code>
        </td>
    </tr>
    <tr>
        <td><strong>Rate Limiting Issues</strong></td>
        <td>
            • Verify Redis is running: <code>redis-cli ping</code><br>
            • Check Redis connection in gateway logs<br>
            • Adjust limits in application.yml
        </td>
    </tr>
</table>

<h2>Dependencies</h2>

<pre><code class="language-xml">&lt;dependencies&gt;
    &lt;!-- Spring Cloud Gateway --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;
    &lt;/dependency&gt;
    
    &lt;!-- Actuator --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
    &lt;/dependency&gt;
    
    &lt;!-- Circuit Breaker --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-starter-circuitbreaker-reactor-resilience4j&lt;/artifactId&gt;
    &lt;/dependency&gt;
    
    &lt;!-- Redis (Rate Limiting) --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-redis-reactive&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>

<h2>Architecture Decision Record</h2>

<div class="info-box">
    <strong>Decision:</strong> Use Spring Cloud Gateway for API Gateway
</div>

<table>
    <tr>
        <th>Aspect</th>
        <th>Details</th>
    </tr>
    <tr>
        <td><strong>Context</strong></td>
        <td>Need unified entry point for multiple microservices with advanced routing capabilities</td>
    </tr>
    <tr>
        <td><strong>Alternatives</strong></td>
        <td>
            • Netflix Zuul (deprecated)<br>
            • Kong Gateway (separate infrastructure)<br>
            • NGINX (limited Spring integration)
        </td>
    </tr>
    <tr>
        <td><strong>Rationale</strong></td>
        <td>
            ✓ Native Spring integration<br>
            ✓ Reactive (WebFlux) for non-blocking I/O<br>
            ✓ Rich feature set (circuit breaker, rate limiting)<br>
            ✓ Easy Java-based configuration<br>
            ✓ Built-in Actuator integration<br>
            ✓ Active development by Spring team
        </td>
    </tr>
    <tr>
        <td><strong>Consequences</strong></td>
        <td>
            ✅ Unified routing and cross-cutting concerns<br>
            ✅ Better performance with reactive model<br>
            ✅ Easy to extend with custom filters<br>
            ⚠️ Requires Redis for rate limiting (optional)<br>
            ⚠️ Learning curve for WebFlux
        </td>
    </tr>
</table>

<footer style="margin-top: 50px; padding-top: 20px; border-top: 2px solid #ddd; text-align: center; color: #666;">
    <p><strong>Document Version:</strong> 1.0</p>
    <p><strong>Last Updated:</strong> October 30, 2025</p>
    <p><strong>Project:</strong> TIBCO BusinessWorks to Spring Boot Migration Framework</p>
</footer>

</body>
</html>
